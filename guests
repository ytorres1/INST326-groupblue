import math
import re

class Guests():
    
    def _init__(self, file):
        """Initializes the guest list with the guests from the file
        
        Attributes:
            guests (list of ): names of guests
        """
        #should open the file and read the guests and other attributes
        #variable/attribute guests will be a list for all the guests in the text file
        self.guests = []
        with(open(file, "r", encoding = "utf-8")) as f:
            for line in f:
                if (line.find(':') == -1):
                    regex = r"^(?P<name>\w+?\s\w+?)\s(?P<rsvp>\w+?)\s(?P<dietres>.+?)\s(?P<phone>\d+?)\s(?P<gender>\w)\s(?P<age>\d+?)$"
                    match = re.search(regex, line)
                    thisGuest = {"Name":match.group("name"), "RSVP":match.group("rsvp"),
                                 "Diet Res":match.group("dietres"), "Phone":match.group("phone"),
                                 "Gender":match.group("gender"), "Age":match.group("age")}
                    self.guests.append(thisGuest)
                    
    def confirmed_guests(self):
        confirmed_guests = []   
        unconfirmed_guests = []           
        for item in self.guests:
            confirmed_guests.append(item.get("Name")) if item.get("RSVP") == "Yes" else unconfirmed_guests.append(item.get("Name"))
    
        return confirmed_guests
        
    def seating_chart(self):
        """Creates a list of an appropriate amount of tables that are 
            full of guests. 
            
            Returns:
                list (lists of strings): list of the guests grouped in tables
                    for the approrpriate amount of guests at a party.
        """
        temp_guest_list = self.guests
        total_guests = len(self.guests)
        
        total_tables = math.ceil(total_guests / 10)
        people_per_table = math.ceil(total_guests / total_tables)
        
        #list comprehension to group the guests in tables and make list of lists
        chart = [temp_guest_list[index: index + people_per_table] for index in range(0, len(temp_guest_list), people_per_table)]
        return chart
    
    def sorted_guests(self, chart):
        """Sorts the list of guests in alphabetical order by last name. 
        
        Args:
            chart (list of lists): a list with the guests grouped by table 
                generated from the seating_chart method
                
        Returns:
            dict: dictionary of guests with guest name as key and their 
                table number as value. 
        """
        
        new_dict = {}
        for table in chart:
            for name in table:
                new_dict[name] = f'Table Number: {chart.index(table) + 1}'
        #sort and use key lambda on the dictionary so that the staff seating people can find people quick by last name
        sorted_dict = new_dict.sort(key=lambda x: x.split()[-1])
        return sorted_dict
    
    
def main():
    choice = input('''What do you want to see? 
                #1 Guests who have RSVP 
                #2 Seating Chart for Guests
                #3 List of seating chart for waiter
                #4 Visualize your guests details
                #5 Distribution of your budget
                Your choice: ''')
    #^ADD MORE CHOICES HERE IF NECESSARY 
    if choice == "1": 
        Guests.confirmed_guests()
    elif choice == "2":
        Guests.seating_chart()
    elif choice == "3":
        Guests.sorted_guests(Guests.seating_chart())
    elif choice == "4":
        #USE THE PANDAS METHOD HERE TO DISPLAY GUESTS DETAILS(BAR CHARTS)
        pass
    elif choice == "5":
        #USE DATAFRAME TO SHOW WHERE TO DISTRIBUTE BUDGET LIKE 
        # DIET RESTRICTIONS, AGE RANGE (KIDS(DECORATIONS), TEENS, ADULTS(GET ADULT DRINKS))
        pass
    else:
        print("Invalid Choice. Try Again!")  
        
    
    
    
    